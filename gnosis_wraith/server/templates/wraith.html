<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gnosis Wraith</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}?v={{ range(10000, 99999) | random }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Favicon links -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ url_for('static', filename='images/favicon.svg') }}"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
    />
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
      type="image/x-icon"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
      type="image/x-icon"
    />
    
    <!-- Added inline script to handle dependent dropdowns and keyboard shortcuts -->
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function() {
        // Check for URL fragment parameters (e.g., /#?q=tech+news&w=1)
        function handleUrlParameters() {
          // Get the URL hash (everything after #)
          const hash = window.location.hash.substring(1);
          
          // If there are parameters after # (e.g. #?q=something)
          if (hash && hash.includes('?')) {
            // Extract the query string part
            const queryString = hash.substring(hash.indexOf('?'));
            const urlParams = new URLSearchParams(queryString);
            
            // Get the query parameter
            const query = urlParams.get('q');
            const shouldSubmit = urlParams.get('w') === '1';
            
            // If query is present, populate the URL input field
            if (query) {
              const urlInput = document.getElementById('url');
              if (urlInput) {
                // Only handle special case for 'tech news' with Ctrl+Y shortcut
                let finalQuery = query;
                if (query.toLowerCase() === 'tech news') {
                  finalQuery = 'https://news.ycombinator.com/';
                } else if (!query.startsWith('http://') && !query.startsWith('https://')) {
                  // If not a URL, don't modify it - it could be a description
                  if (query.includes('.') && !query.includes(' ')) {  // Only add https:// if it looks like a pure domain
                    finalQuery = 'https://' + query;
                    console.log(`Added https:// prefix to: ${query}`);
                  }
                }
                
                // Set the value in the input field
                urlInput.value = finalQuery;
                
                // Highlight the input to show it was populated
                urlInput.classList.add('highlight-input');
                setTimeout(() => {
                  urlInput.classList.remove('highlight-input');
                }, 500);
                
                // If w=1, also submit the form
                if (shouldSubmit) {
                  // Click the crawl button after a short delay
                  setTimeout(() => {
                    const crawlBtn = document.getElementById('crawl-btn');
                    if (crawlBtn) {
                      crawlBtn.click();
                    }
                  }, 300);
                }
                
                // Clear the URL fragment to avoid resubmission on refresh
                // Use replaceState to modify the URL without adding to browser history
                if (window.history && window.history.replaceState) {
                  window.history.replaceState(null, document.title, window.location.pathname);
                }
              }
            }
          }
        }
        
        // Run URL parameter handler on page load
        handleUrlParameters();
        
        // Setup the dependency between screenshot and OCR options
        const screenshotSelect = document.getElementById('take-screenshot');
        const ocrSelect = document.getElementById('ocr-extraction');
        const ocrFormGroup = ocrSelect ? ocrSelect.closest('.form-group') : null;
        
        function updateOcrOptions() {
          if (!screenshotSelect || !ocrSelect) return;
          
          if (screenshotSelect.value === 'false') {
            // If screenshots are disabled, disable OCR and set to "No"
            ocrSelect.value = 'false';
            ocrSelect.disabled = true;
            if (ocrFormGroup) ocrFormGroup.classList.add('disabled-option');
            console.log('Screenshots disabled, OCR also disabled');
          } else {
            // If screenshots are enabled, enable OCR
            ocrSelect.disabled = false;
            if (ocrFormGroup) ocrFormGroup.classList.remove('disabled-option');
            console.log('Screenshots enabled, OCR enabled');
          }
        }
        
        // Add change handler to screenshot select
        if (screenshotSelect) {
          updateOcrOptions(); // Initialize state
          screenshotSelect.addEventListener('change', updateOcrOptions);
        }
        
        // Add keyboard shortcut for Ctrl+Y to populate URL and start crawling
        document.addEventListener('keydown', function(e) {
          // Check if Ctrl+Y is pressed
          if (e.ctrlKey && e.key === 'y') {
            const urlInput = document.getElementById('url');
            const crawlBtn = document.getElementById('crawl-btn');
            
            // If URL field is empty or not focused, populate it and click the button
            if (urlInput && crawlBtn && 
                (document.activeElement !== urlInput || urlInput.value.trim() === '')) {
              // Prevent default browser behavior
              e.preventDefault();
              
              // Populate with Hacker News URL
              urlInput.value = 'https://news.ycombinator.com/';
              
              // Flash the URL input to indicate it's been populated
              urlInput.classList.add('highlight-input');
              setTimeout(() => {
                urlInput.classList.remove('highlight-input');
              }, 500);
              
              // Click the crawl button after a short delay
              setTimeout(() => {
                crawlBtn.click();
              }, 300);
            }
          }
        });
      });
    </script>
    
    <!-- Add some CSS for disabled options and Highlight effects -->
    <style>
      .disabled-option {
        opacity: 0.6;
      }
      
      .disabled-option select {
        background-color: #f1f1f1;
      }
      
      /* Highlight effect for keyboard shortcut */
      @keyframes highlight-pulse {
        0% { background-color: transparent; }
        50% { background-color: rgba(92, 184, 92, 0.2); }
        100% { background-color: transparent; }
      }
      
      .highlight-input {
        animation: highlight-pulse 0.5s ease-in-out;
      }
      
      /* Keyboard key style */
      kbd {
        display: inline-block;
        padding: 1px 5px;
        margin: 0 2px;
        font-size: 0.85em;
        font-family: monospace;
        background-color: #f7f7f7;
        color: #0c0c0c;
        font-weight: bold;
        border: 1px solid #ccc;
        border-radius: 3px;
        box-shadow: 0 1px 0 rgba(0,0,0,0.2);
      }
      
      /* Action buttons styles */
      .action-buttons {
        display: flex;
        justify-content: flex-end;
        flex-wrap: wrap;
        margin: 15px 0;
      }
      
      .btn.danger {
        background-color: #e74c3c;
        color: white;
        border: 1px solid #c0392b;
      }
      
      .btn.danger:hover {
        background-color: #c0392b;
      }
      
      /* Google-inspired search styling */
      .ghost-search-container {
        max-width: 750px;
        margin: 0 auto;
        padding: 20px 0;
      }
      
      .ghost-search-box {
        display: flex;
        align-items: center;
        border: 1px solid var(--border-color);
        border-radius: 24px;
        padding: 6px 8px 6px 16px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        background: var(--card-bg);
        transition: all 0.3s ease;
      }
      
      .ghost-search-box:focus-within,
      .ghost-search-box.highlight {
        box-shadow: 0 2px 10px rgba(108, 99, 255, 0.3);
        border-color: #6c63ff;
      }
      
      .ghost-search-box input {
        flex-grow: 1;
        border: none;
        padding: 12px 0;
        font-size: 16px;
        background: transparent;
        color: var(--text-color);
        outline: none;
      }
      
      .ghost-search-icon {
        color: #6c63ff;
        font-size: 20px;
        margin-right: 10px;
      }
      
      .ghost-search-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #6c63ff;
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .ghost-search-button:hover {
        background: #5a52d5;
        transform: scale(1.05);
      }
      
      .ghost-mic-button,
      .ghost-file-button {
        background: transparent;
        border: none;
        width: 24px;
        height: 24px;
        margin-right: 8px;
        cursor: pointer;
        color: #5a52d5;
      }
      
      .ghost-file-button:hover {
        color: #6c63ff;
      }
      
      /* Style for file selected state */
      .file-selected {
        color: #6c63ff !important;
        font-weight: 500;
      }
      
      /* Custom toggles and controls */
      .ghost-controls {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }
      
      .ghost-control-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        transition: all 0.3s;
      }
      
      .ghost-control-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        transform: translateY(-2px);
      }
      
      .ghost-control-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      
      .ghost-control-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f0f4ff;
        color: #6c63ff;
        border-radius: 8px;
        margin-right: 10px;
      }
      
      .ghost-control-title {
        font-size: 15px;
        font-weight: 500;
        color: var(--text-color);
        margin: 0;
      }
      
      /* Toggle Switch */
      .ghost-toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      
      .ghost-toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .ghost-toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
      }
      
      .ghost-toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      
      input:checked + .ghost-toggle-slider {
        background-color: #6c63ff;
      }
      
      input:checked + .ghost-toggle-slider:before {
        transform: translateX(26px);
      }
      
      /* Radio Button Group */
      .ghost-radio-group {
        display: flex;
        background: var(--card-bg);
        border-radius: 20px;
        padding: 4px;
        margin-top: 10px;
        border: 3px solid #ffffff; /* Thick white border for the entire group */
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
      
      .ghost-radio-button {
        flex: 1;
        text-align: center;
        padding: 8px 4px;
        font-size: 13px;
        cursor: pointer;
        border-radius: 14px;
        transition: all 0.2s;
        user-select: none;
        font-weight: 500; /* Medium weight for all states */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 45px; /* Ensure enough height for the two lines */
        line-height: 1.3;
        margin: 2px;
        border: none; /* No border on individual buttons */
      }
      
      .ghost-radio-active {
        background: #6c63ff;
        color: white;
        font-weight: 600; /* Slightly bolder for the active state */
        box-shadow: 0 2px 4px rgba(108, 99, 255, 0.3);
      }

      .ghost-radio-button:not(.ghost-radio-active) {
        background: var(--card-bg);
        color: #999; /* Much lighter text color for inactive buttons */
      }
      
      .ghost-radio-button:hover:not(.ghost-radio-active) {
        background: rgba(108, 99, 255, 0.1);
        color: #666; /* Slightly darker on hover, but still light */
      }
      
      /* Submit button */
      .ghost-submit {
        display: flex;
        justify-content: center;
        margin-top: 30px;
      }
      
      .ghost-crawl-btn {
        background: linear-gradient(135deg, #6c63ff 0%, #5a52d5 100%);
        color: white;
        border: none;
        border-radius: 24px;
        padding: 12px 30px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
        display: flex;
        align-items: center;
      }
      
      .ghost-crawl-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
      }
      
      .ghost-crawl-btn i {
        margin-right: 10px;
      }
      
      /* Report title input styling */
      .ghost-input {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 12px;
        background: var(--input-bg);
        color: var(--text-color);
        font-size: 14px;
        transition: all 0.3s;
        width: 100%;
      }
      
      .ghost-input:focus {
        border-color: #6c63ff;
        box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2);
        outline: none;
      }
      
      .ghost-input::placeholder {
        color: #999;
      }
      
      /* Report title container animation */
      #report-title-container {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease-out, padding 0.4s ease-out, opacity 0.4s ease-out;
        opacity: 0;
        margin: 0;
      }
      
      #report-title-container.visible {
        max-height: 180px; /* Increased from 60px to allow more space */
        padding: 15px 0;
        margin-bottom: 10px;
        opacity: 1;
      }
      
      /* Fancy animation effects */
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      .pulse-animation {
        animation: pulse 1.5s infinite ease-in-out;
      }
      
      /* Ghost link styling */
      .ghost-link {
        color: #8CB4FF;
        text-decoration: none !important;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
      }
      
      .ghost-link:hover {
        color: #A9CBFF;
        text-decoration: none !important;
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <div class="logo">
        <a href="{{ url_for('pages.index') }}">
          <span>Gnosis Wraith <span id="flying-ghost" class="ghost-emoji" title="Click me or press Ctrl+G to make me fly!">👻</span></span>
        </a>
      </div>
      <ul class="nav-menu">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">
            <i class="fas fa-bars"></i>
          </a>
          <ul class="dropdown-menu">
            <li><a href="{{ url_for('pages.list_reports') }}">Reportage</a></li>
            <li><a href="{{ url_for('pages.settings') }}">Settings</a></li>
            <li><a href="#" id="terminal-link">Terminal</a></li>
          </ul>
        </li>
      </ul>
    </nav>
    
    <!-- Ghost animation styles and script -->
    <style>
      .ghost-emoji {
        display: inline-block;
        position: relative;
        transition: transform 0.2s ease;
        z-index: 2;
      }
      
      /* Multiple flight patterns */
      @keyframes flyRight {
        0% {
          transform: translateX(0) translateY(0) scale(1);
          opacity: 1;
        }
        
        /* Move steadily first */
        40% {
          transform: translateX(calc(30vw)) translateY(0) scale(1);
          opacity: 1;
        }
        
        /* Accelerate and start fading */
        80% {
          transform: translateX(calc(70vw)) translateY(0) scale(0.9);
          opacity: 0.7;
        }
        
        /* Final acceleration and fade out */
        100% {
          transform: translateX(calc(110vw)) translateY(0) scale(0.7);
          opacity: 0;
        }
      }
      
      @keyframes flyUp {
        0% {
          transform: translateX(0) translateY(0) scale(1);
          opacity: 1;
        }
        
        /* Float up slowly first */
        40% {
          transform: translateX(20px) translateY(-20vh) scale(1);
          opacity: 1;
        }
        
        /* Continue rising and fading */
        80% {
          transform: translateX(40px) translateY(-60vh) scale(0.9);
          opacity: 0.6;
        }
        
        /* Final fade out off the top */
        100% {
          transform: translateX(60px) translateY(-110vh) scale(0.7);
          opacity: 0;
        }
      }
      
      @keyframes flyLeft {
        0% {
          transform: translateX(0) translateY(0) scale(1);
          opacity: 1;
        }
        
        /* Move steadily first */
        40% {
          transform: translateX(-30vw) translateY(0) scale(1);
          opacity: 1;
        }
        
        /* Accelerate and start fading */
        80% {
          transform: translateX(-70vw) translateY(0) scale(0.9);
          opacity: 0.7;
        }
        
        /* Final acceleration and fade out */
        100% {
          transform: translateX(-110vw) translateY(0) scale(0.7);
          opacity: 0;
        }
      }
      
      @keyframes fadeOut {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
        
        100% {
          transform: scale(0.5);
          opacity: 0;
        }
      }
      
      .ghost-flying {
        position: fixed;
        z-index: 999;
      }
      
      .ghost-flying-right {
        animation: flyRight 2.5s cubic-bezier(0.33, 1, 0.68, 1) forwards;
      }
      
      .ghost-flying-left {
        animation: flyLeft 2.5s cubic-bezier(0.33, 1, 0.68, 1) forwards;
      }
      
      .ghost-flying-up {
        animation: flyUp 3s cubic-bezier(0.33, 1, 0.68, 1) forwards;
      }
      
      .ghost-flying-fade {
        animation: fadeOut 2s cubic-bezier(0.33, 1, 0.68, 1) forwards;
      }
      
      /* Prevent ghost animation from messing with layout */
      .ghost-placeholder {
        opacity: 0;
        visibility: hidden;
      }
    </style>
    
    <script>
      // Wait until DOM is loaded
      document.addEventListener('DOMContentLoaded', function() {
        const ghost = document.getElementById('flying-ghost');
        if (!ghost) return;
        
        // Clean up any existing ghost clones (in case of page refresh during animation)
        const existingClones = document.querySelectorAll('[id^="flying-ghost-clone"]');
        existingClones.forEach(clone => {
          try {
            document.body.removeChild(clone);
          } catch (e) {
            console.log("Error removing clone:", e);
          }
        });
        
        // Function to make the ghost fly
        function makeGhostFly() {
          // Don't start a new animation if one is in progress
          if (document.querySelector('[id^="flying-ghost-clone"]')) return;
          
          // Create a clone to animate (this prevents layout shifts)
          const ghostClone = ghost.cloneNode(true);
          const cloneId = 'flying-ghost-clone-' + Date.now();
          ghostClone.id = cloneId;
          document.body.appendChild(ghostClone);
          
          // Position the clone exactly where the original ghost is
          const ghostRect = ghost.getBoundingClientRect();
          ghostClone.style.position = 'fixed';
          ghostClone.style.top = ghostRect.top + 'px';
          ghostClone.style.left = ghostRect.left + 'px';
          ghostClone.style.zIndex = '999';
          
          // Make the ghost temporarily invisible (but maintain space)
          ghost.classList.add('ghost-placeholder');
          
          // Choose a random flight pattern
          ghostClone.classList.add('ghost-flying');
          const flightPatterns = ['ghost-flying-right', 'ghost-flying-left', 'ghost-flying-up', 'ghost-flying-fade'];
          const randomPattern = flightPatterns[Math.floor(Math.random() * flightPatterns.length)];
          ghostClone.classList.add(randomPattern);
          
          // Set animation duration based on the pattern
          let animationDuration = 0;
          switch(randomPattern) {
            case 'ghost-flying-right':
            case 'ghost-flying-left':
              animationDuration = 2500; // 2.5 seconds
              break;
            case 'ghost-flying-up':
              animationDuration = 3000; // 3 seconds
              break;
            case 'ghost-flying-fade':
              animationDuration = 2000; // 2 seconds
              break;
            default:
              animationDuration = 3000; // Default 3 seconds
          }
          
          // Clean up after animation
          ghostClone.addEventListener('animationend', () => cleanupGhost(cloneId, animationDuration));
          
          // Backup cleanup in case the animationend event doesn't fire
          const cleanupTimeout = setTimeout(() => cleanupGhost(cloneId, animationDuration), animationDuration + 1000);
          
          function cleanupGhost(id, duration) {
            // Prevent duplicate cleanup
            const cloneElement = document.getElementById(id);
            if (!cloneElement) return;
            
            clearTimeout(cleanupTimeout);
            
            // Remove the clone
            try {
              document.body.removeChild(cloneElement);
            } catch (e) {
              console.log("Error removing clone:", e);
            }
            
            // Make the original ghost visible again, but after a short delay
            // to prevent any visual "bounce back" effect
            setTimeout(() => {
              ghost.classList.remove('ghost-placeholder');
              
              // Add a small wiggle effect as the ghost "reappears"
              ghost.style.animation = 'wiggle 0.5s ease';
              setTimeout(() => {
                ghost.style.animation = '';
              }, 500);
            }, 100);
          }
        }
        
        // Add a wiggle effect for when the ghost reappears
        const style = document.createElement('style');
        style.textContent = `
          @keyframes wiggle {
            0% { transform: translateX(0) rotate(0); }
            25% { transform: translateX(-3px) rotate(-5deg); }
            50% { transform: translateX(3px) rotate(5deg); }
            75% { transform: translateX(-2px) rotate(-3deg); }
            100% { transform: translateX(0) rotate(0); }
          }
        `;
        document.head.appendChild(style);
        
        // Start random ghost flights
        function scheduleRandomFlight() {
          // Random time between 3 and 8 minutes (180000 - 480000 ms)
          // But occasionally (5% chance) appear quickly (3-10 seconds)
          let randomDelay;
          
          if (Math.random() < 0.05) {
            // Quick reappearance (5% chance)
            randomDelay = Math.floor(Math.random() * 7000) + 3000; // 3-10 seconds
            console.log("Ghost will reappear quickly in " + (randomDelay/1000) + " seconds");
          } else {
            // Normal long delay
            randomDelay = Math.floor(Math.random() * 300000) + 180000; // 3-8 minutes
            console.log("Ghost will hibernate for " + (randomDelay/60000).toFixed(1) + " minutes");
          }
          
          setTimeout(() => {
            makeGhostFly();
            scheduleRandomFlight(); // Schedule the next flight
          }, randomDelay);
        }
        
        // Also trigger on clicking the ghost
        ghost.addEventListener('click', function(e) {
          // Don't navigate when clicking the ghost
          e.preventDefault();
          e.stopPropagation();
          makeGhostFly();
        });
        
        // Add keyboard shortcut: Ctrl+G to trigger ghost flight
        document.addEventListener('keydown', function(e) {
          // Check if Ctrl+G is pressed
          if (e.ctrlKey && (e.key === 'g' || e.key === 'G')) {
            // Prevent default browser behavior (which might be "find next")
            e.preventDefault();
            
            // Log to console to verify shortcut is working
            console.log("Ctrl+G shortcut detected - ghost should fly now!");
            
            // Force immediate ghost flight
            makeGhostFly();
            
            // Return false to ensure the browser doesn't handle this key combination
            return false;
          }
        });
        
        // Start the random flight scheduling
        scheduleRandomFlight();
      });
    </script>

    <div class="container">
      <main>
        <!-- Simplified Single URL Crawl section - no tab structure -->
        <section class="card">
          <div class="crawl-form">
            <!-- Google-style search input -->
            <div class="ghost-search-container">
              <div class="ghost-search-box">
                <i class="fas fa-ghost ghost-search-icon"></i>
                <input
                  type="text"
                  id="url"
                  placeholder="Describe what you want to crawl, upload a file, or enter a URL..."
                  autocomplete="off"
                />
                <button class="ghost-mic-button" title="Search by voice">
                  <i class="fas fa-microphone"></i>
                </button>
                <!-- Add a file selection button here -->
                <button class="ghost-file-button" title="Select file to analyze" id="main-file-select-btn" style="position: relative; z-index: 1;">
                  <i class="fas fa-file-upload"></i>
                  <span style="position: absolute; width: 32px; height: 32px; background-color: rgba(108, 99, 255, 0.2); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: -1;"></span>
                </button>
                <!-- Add X button to clear file selection, hidden by default -->
                <button class="ghost-clear-button" title="Remove selected file" id="clear-file-btn" style="display: none; background: transparent; border: none; width: 24px; height: 24px; margin-right: 8px; cursor: pointer; color: #ff6161;">
                  <i class="fas fa-times-circle"></i>
                </button>
                <button id="instant-crawl" class="ghost-search-button" title="Feeling Lucky">
                  <i class="fas fa-bolt"></i>
                </button>
                <!-- Hidden file input for the file selection -->
                <input type="file" id="main-file-input" style="display: none;" accept="image/png,image/jpeg,image/jpg,image/gif,image/bmp,application/pdf" />
              </div>
              
              <p class="help-text" style="text-align: center; margin-top: 8px; line-height: 1.8;">
                Press <kbd>Ctrl</kbd>+<kbd>Y</kbd> for tech news
              </p>
              
              <!-- Fun controls in cards -->
              <div class="ghost-controls">
                <!-- Screenshot Card -->
                <div class="ghost-control-card">
                  <div class="ghost-control-header">
                    <div class="ghost-control-icon">
                      <i class="fas fa-camera"></i>
                    </div>
                    <label class="ghost-toggle-switch" style="margin-left: 8px; margin-right: 12px;">
                      <input type="checkbox" id="take-screenshot-toggle" checked>
                      <span class="ghost-toggle-slider"></span>
                    </label>
                    <h3 class="ghost-control-title">Screenshot Capture</h3>
                  </div>
                </div>
                
                <!-- OCR Card -->
                <div class="ghost-control-card">
                  <div class="ghost-control-header">
                    <div class="ghost-control-icon">
                      <i class="fas fa-eye"></i>
                    </div>
                    <label class="ghost-toggle-switch" style="margin-left: 8px; margin-right: 12px;">
                      <input type="checkbox" id="ocr-extraction-toggle">
                      <span class="ghost-toggle-slider"></span>
                    </label>
                    <h3 class="ghost-control-title">OCR Extraction</h3>
                  </div>
                </div>
                
                <!-- Content Processing Card -->
                <div class="ghost-control-card">
                  <div class="ghost-control-header">
                    <div class="ghost-control-icon">
                      <i class="fas fa-cogs"></i>
                    </div>
                    <h3 class="ghost-control-title">Content Processing</h3>
                  </div>
                  <div class="ghost-radio-group" id="markdown-radio-group">
                    <div class="ghost-radio-button ghost-radio-active" data-value="enhanced">
                      <i class="fas fa-magic"></i> Enhanced
                    </div>
                    <div class="ghost-radio-button" data-value="basic">
                      <i class="fas fa-file-alt" style="opacity: 0.6;"></i> Basic
                    </div>
                    <div class="ghost-radio-button" data-value="none">
                      <i class="fas fa-code" style="opacity: 0.6;"></i> Raw Text<br>
                      <span style="font-size: 10px; opacity: 0.6;">(from DOM)</span>
                    </div>
                  </div>
                </div>
                
                <!-- JavaScript Card -->
                <div class="ghost-control-card">
                  <div class="ghost-control-header">
                    <div class="ghost-control-icon">
                      <i class="fas fa-code"></i>
                    </div>
                    <label class="ghost-toggle-switch" style="margin-left: 8px; margin-right: 12px;">
                      <input type="checkbox" id="javascript-enabled-toggle">
                      <span class="ghost-toggle-slider"></span>
                    </label>
                    <h3 class="ghost-control-title">JavaScript</h3>
                  </div>
                </div>
              </div>
              
              <!-- Custom report title toggle and input (hidden by default) -->
              <div class="ghost-control-card" style="margin-bottom: 20px;">
                <div class="ghost-control-header">
                  <div class="ghost-control-icon">
                    <i class="fas fa-heading"></i>
                  </div>
                  <label class="ghost-toggle-switch" style="margin-left: 8px; margin-right: 12px;">
                    <input type="checkbox" id="report-title-toggle">
                    <span class="ghost-toggle-slider"></span>
                  </label>
                  <h3 class="ghost-control-title">Custom Report Title</h3>
                </div>
                <!-- Report title input (hidden by default) -->
                <div id="report-title-container" style="display: none;">
                  <div style="background: #f0f4ff; border-radius: 8px; padding: 15px; margin-top: 10px; margin-bottom: 5px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                    <input
                      type="text"
                      id="report-title"
                      placeholder="Web Crawl Report"
                      class="ghost-input"
                      style="display: block; width: 100%; margin-bottom: 10px;"
                    />
                    <p style="margin: 8px 0 0 0; font-size: 12px; color: #666; line-height: 1.4;">
                      <i class="fas fa-info-circle"></i> 
                      This title will appear at the top of generated reports
                    </p>
                  </div>
                </div>
              </div>
              
              <!-- Submit button -->
              <div class="ghost-submit">
                <button id="crawl-btn" class="ghost-crawl-btn">
                  <i class="fas fa-ghost pulse-animation"></i>
                  Unleash the Wraith
                </button>
              </div>
            </div>
            
            <!-- Hidden fields to store actual values for form submission -->
            <select id="take-screenshot" style="display: none;">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
            
            <select id="ocr-extraction" style="display: none;">
              <option value="true">Yes</option>
              <option value="false" selected>No</option>
            </select>
            
            <select id="markdown-extraction" style="display: none;">
              <option value="enhanced" selected>Enhanced</option>
              <option value="basic">Basic</option>
              <option value="none">None</option>
            </select>
            
            <select id="javascript-enabled-single" style="display: none;">
              <option value="false" selected>Disabled</option>
              <option value="true">Enabled</option>
            </select>
            
            <input type="hidden" id="report-title-hidden" name="report-title" value="">
          </div>
          
          <!-- Status box (initially hidden) -->
          <div id="crawl-status" class="status-box" style="display: none">
            <p>Status: <span id="status-text">Idle</span></p>
            <div class="progress-bar">
              <div id="progress-indicator"></div>
            </div>
          </div>
        </section>

        <!-- Crawl Results Section -->
        <section id="crawl-results" class="card" style="display: none">
          <div id="results-summary" style="font-size: 1.2em; margin-bottom: 15px; font-weight: bold;"></div>
          
          <!-- Add action buttons at the top -->
          <div id="results-actions-top" class="action-buttons" style="margin: 10px 0 15px 0; text-align: right;">
            <a
              id="html-link-top"
              href="#"
              class="btn primary"
              style="margin-right: 5px;"
              target="_blank"
              title="View formatted HTML report with full styling"
              >
              <i class="fas fa-file-alt"></i> View HTML Report</a
            >
            <a
              id="report-link-top"
              href="#"
              class="btn secondary"
              style="display: none; margin-right: 5px;"
              target="_blank"
              title="View raw markdown report"
              >
              <i class="fas fa-code"></i> View Raw Report</a
            >
            <button
              id="delete-report-btn"
              class="btn danger"
              style="display: none;"
              >
              <i class="fas fa-trash"></i> Delete Report</button
            >
          </div>
          
          <div id="results-content"></div>
          
          <!-- Keep the bottom actions too for convenience -->
          <div id="results-actions" style="margin-top: 20px;">
            <a
              id="html-link"
              href="#"
              class="btn primary"
              style="display: none"
              target="_blank"
              >View Report</a
            >
            <a
              id="report-link"
              href="#"
              class="btn secondary"
              style="display: none"
              target="_blank"
              >View Raw Report</a
            >
          </div>
        </section>
      </main>

      <!-- Simple footer -->
      <footer class="corporate-footer">
        <div class="footer-container">
          <!-- Logo and project description -->
          <div class="footer-brand">
            <div class="footer-logo">
              <i class="fas fa-ghost"></i>
              <span>Gnosis Wraith 👻</span>
            </div>
            <p class="copyright">&copy; 2025 Gnosis</p>
          </div>
          
          <!-- Simplified navigation links -->
          <div class="footer-links">
            <div class="footer-col">
              <h4>Product</h4>
              <ul>
                <li><a href="{{ url_for('pages.wraith') }}">Wraith</a></li>
                <li><a href="#">Docs</a></li>
                <li><a href="#">API</a></li>
                <li><a href="#">Open on GitHub</a></li>
              </ul>
            </div>
            
            <div class="footer-col">
              <h4>Company</h4>
              <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">License</a></li>
                <li><a href="#">Terms</a></li>
              </ul>
            </div>
          </div>
        </div>
      </footer>
      
      <!-- Simplified footer styles -->
      <style>
        .corporate-footer {
          background-color: transparent;
          color: var(--text-muted);
          padding: 20px 0 15px;
          margin-top: 30px;
          border-top: 1px solid var(--border-color);
        }
        
        .footer-container {
          max-width: 1100px;
          margin: 0 auto;
          padding: 0 20px;
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
        }
        
        .footer-brand {
          flex: 0 0 260px;
          margin-bottom: 20px;
        }
        
        .footer-logo {
          display: flex;
          align-items: center;
          margin-bottom: 12px;
        }
        
        .footer-logo i {
          font-size: 1.8rem;
          color: #6c63ff;
          margin-right: 10px;
        }
        
        .footer-logo span {
          font-size: 1.4rem;
          font-weight: bold;
          color: var(--text-color);
        }
        
        
        
        .copyright {
          font-size: 0.75rem;
          color: var(--text-muted);
        }
        
        .footer-links {
          display: flex;
          flex-wrap: wrap;
          gap: 30px;
        }
        
        .footer-col {
          flex: 0 0 120px;
        }
        
        .footer-col h4 {
          color: var(--text-color);
          margin-bottom: 6px;
          font-size: 1rem;
          font-weight: 500;
        }
        
        .footer-col ul {
          list-style: none;
          padding: 0;
          margin: 0;
        }
        
        .footer-col ul li {
          margin-bottom: 3px;
        }
        
        .footer-col ul li a {
          color: var(--text-muted);
          text-decoration: none;
          transition: color 0.2s ease;
          font-size: 0.85rem;
        }
        
        .footer-col ul li a:hover {
          color: #6c63ff;
        }
        
        /* Mobile responsive footer */
        @media (max-width: 768px) {
          .footer-container {
            flex-direction: column;
          }
          
          .footer-brand {
            flex: 0 0 100%;
            margin-bottom: 25px;
            text-align: center;
          }
          
          .footer-logo {
            justify-content: center;
          }
          
          .footer-links {
            justify-content: center;
          }
        }
        
        @media (max-width: 480px) {
          .footer-links {
            flex-direction: column;
            align-items: center;
            gap: 20px;
          }
          
          .footer-col {
            text-align: center;
            flex: 0 0 100%;
          }
        }
      </style>
    </div>

    <!-- Terminal overlay (hidden by default) -->
    <div id="terminal-overlay" style="display: none;">
      <div id="terminal-container">
        <div id="terminal-header">
          <div class="terminal-title">Gnosis Wraith Terminal</div>
          <div class="terminal-controls">
            <span class="minimize-btn">_</span>
            <span class="maximize-btn">□</span>
            <span class="close-btn" id="terminal-close">×</span>
          </div>
        </div>
        <div id="terminal-content">
          <div id="terminal-output">
            <div class="terminal-line">Welcome to Gnosis Wraith Terminal v1.0.3</div>
            <div class="terminal-line">Type 'help' for available commands</div>
            <div class="terminal-line"> </div>
            <div class="terminal-line">gnosis-wraith$ <span class="terminal-cursor">_</span></div>
          </div>
          <div id="terminal-input-container">
            <span class="terminal-prompt">gnosis-wraith$ </span>
            <input type="text" id="terminal-input" autocomplete="off" spellcheck="false">
          </div>
        </div>
      </div>
    </div>
    
    <!-- Terminal styles -->
    <style>
      /* Terminal Mode for Navigation */
      .navbar.terminal-mode {
        background-color: #0a0a0a;
        border-bottom: 1px solid #2fd455;
        box-shadow: 0 0 10px rgba(47, 212, 85, 0.5);
        transition: all 0.3s ease;
      }
      
      .navbar.terminal-mode .logo a span,
      .navbar.terminal-mode .nav-menu a {
        color: #2fd455;
        text-shadow: 0 0 5px rgba(47, 212, 85, 0.7);
      }
      
      .navbar.terminal-mode .logo i,
      .navbar.terminal-mode .ghost-search-icon {
        color: #2fd455;
        animation: pulse-green 2s infinite;
      }
      
      @keyframes pulse-green {
        0% { text-shadow: 0 0 5px rgba(47, 212, 85, 0.7); }
        50% { text-shadow: 0 0 15px rgba(47, 212, 85, 1); }
        100% { text-shadow: 0 0 5px rgba(47, 212, 85, 0.7); }
      }
      
      /* Terminal Overlay */
      #terminal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      #terminal-container {
        width: 80%;
        max-width: 900px;
        height: 70%;
        background-color: #0a0a0a;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(47, 212, 85, 0.5);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        font-family: 'Courier New', monospace;
      }
      
      #terminal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #161616;
        padding: 8px 15px;
        border-bottom: 1px solid #2fd455;
      }
      
      .terminal-title {
        color: #2fd455;
        font-weight: bold;
      }
      
      .terminal-controls {
        display: flex;
        gap: 12px;
      }
      
      .terminal-controls span {
        cursor: pointer;
        display: inline-block;
        width: 16px;
        height: 16px;
        text-align: center;
        line-height: 16px;
        border-radius: 50%;
        color: #333;
        font-weight: bold;
      }
      
      .minimize-btn { background-color: #f1c40f; }
      .maximize-btn { background-color: #2ecc71; }
      .close-btn { background-color: #e74c3c; }
      
      #terminal-content {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        color: #2fd455;
      }
      
      .terminal-line {
        line-height: 1.5;
        margin-bottom: 5px;
        white-space: pre-wrap;
      }
      
      #terminal-input-container {
        display: flex;
        margin-top: 10px;
      }
      
      .terminal-prompt {
        color: #2fd455;
        margin-right: 8px;
      }
      
      #terminal-input {
        flex: 1;
        background: transparent;
        border: none;
        color: #2fd455;
        font-family: 'Courier New', monospace;
        font-size: inherit;
        caret-color: #2fd455;
        outline: none;
      }
      
      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
      }
      
      .terminal-cursor {
        display: inline-block;
        width: 10px;
        height: 16px;
        background-color: #2fd455;
        animation: blink 1s infinite;
        vertical-align: middle;
      }
    </style>

    <script src="{{ url_for('static', filename='js/script.js') }}?v={{ range(10000, 99999) | random }}"></script>
    <script src="{{ url_for('static', filename='js/upload.js') }}?v={{ range(10000, 99999) | random }}"></script>
    
    <!-- Terminal JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const terminalLink = document.getElementById('terminal-link');
        const terminalOverlay = document.getElementById('terminal-overlay');
        const terminalClose = document.getElementById('terminal-close');
        const navbar = document.querySelector('.navbar');
        const terminalInput = document.getElementById('terminal-input');
        const terminalOutput = document.getElementById('terminal-output');
        
        // Terminal open/close logic
        terminalLink.addEventListener('click', function(e) {
          e.preventDefault();
          terminalOverlay.style.display = 'flex';
          navbar.classList.add('terminal-mode');
          setTimeout(() => {
            terminalInput.focus();
          }, 100);
        });
        
        terminalClose.addEventListener('click', function() {
          terminalOverlay.style.display = 'none';
          navbar.classList.remove('terminal-mode');
        });
        
        // Escape key to close terminal
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && terminalOverlay.style.display === 'flex') {
            terminalOverlay.style.display = 'none';
            navbar.classList.remove('terminal-mode');
          }
        });
        
        // Basic terminal functionality
        terminalInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            const command = this.value.trim();
            // Clear input
            this.value = '';
            
            // Add command to output
            const commandLine = document.createElement('div');
            commandLine.className = 'terminal-line';
            commandLine.textContent = 'gnosis-wraith$ ' + command;
            terminalOutput.appendChild(commandLine);
            
            // Process command
            processCommand(command);
            
            // Scroll to bottom
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
          }
        });
        
        function processCommand(command) {
          let response;
          
          switch(command.toLowerCase()) {
            case 'help':
              response = [
                'Available commands:',
                '  help         - Display this help message',
                '  clear        - Clear the terminal screen',
                '  version      - Show Gnosis Wraith version',
                '  status       - Check the system status',
                '  ghost        - Summon the ghost',
                '  exit         - Close the terminal'
              ].join('\n');
              break;
            
            case 'clear':
              terminalOutput.innerHTML = '';
              return;
            
            case 'version':
              response = 'Gnosis Wraith v1.0.3 (Terminal Build)';
              break;
            
            case 'status':
              response = 'All systems operational. Web crawler ready.';
              break;
            
            case 'ghost':
              response = '👻 The ghost has been summoned!\n\n' +
                         '     .-.     \n' +
                         '    (o o)    \n' +
                         '    | O \\    \n' +
                         '     \\   \\   \n' +
                         '      `~~~\'  ';
              break;
            
            case 'exit':
              terminalOverlay.style.display = 'none';
              navbar.classList.remove('terminal-mode');
              return;
            
            case '':
              response = '';
              break;
            
            default:
              response = `Command not found: ${command}. Type 'help' for available commands.`;
          }
          
          // Add response to output
          const responseLine = document.createElement('div');
          responseLine.className = 'terminal-line';
          responseLine.textContent = response;
          terminalOutput.appendChild(responseLine);
          
          // Add new prompt line
          const newPromptLine = document.createElement('div');
          newPromptLine.className = 'terminal-line';
          newPromptLine.innerHTML = 'gnosis-wraith$ <span class="terminal-cursor">_</span>';
          terminalOutput.appendChild(newPromptLine);
        }
      });
    </script>
    
    <!-- JavaScript to handle the UI controls -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Toggle switches
        document.getElementById('take-screenshot-toggle').addEventListener('change', function() {
          document.getElementById('take-screenshot').value = this.checked ? 'true' : 'false';
          
          // If screenshots disabled, disable OCR too
          if (!this.checked) {
            document.getElementById('ocr-extraction-toggle').checked = false;
            document.getElementById('ocr-extraction-toggle').disabled = true;
            document.getElementById('ocr-extraction').value = 'false';
          } else {
            document.getElementById('ocr-extraction-toggle').disabled = false;
          }
        });
        
        document.getElementById('ocr-extraction-toggle').addEventListener('change', function() {
          document.getElementById('ocr-extraction').value = this.checked ? 'true' : 'false';
        });
        
        document.getElementById('javascript-enabled-toggle').addEventListener('change', function() {
          document.getElementById('javascript-enabled-single').value = this.checked ? 'true' : 'false';
        });
        
        // Report title toggle with animation
        document.getElementById('report-title-toggle').addEventListener('change', function() {
          const reportTitleContainer = document.getElementById('report-title-container');
          if (this.checked) {
            // First make it display block, then add the visible class for animation
            reportTitleContainer.style.display = 'block';
            // Force a reflow to ensure the display change is processed before adding the class
            void reportTitleContainer.offsetWidth;
            reportTitleContainer.classList.add('visible');
          } else {
            // First remove the visible class for animation
            reportTitleContainer.classList.remove('visible');
            // Then hide it after the animation completes
            setTimeout(() => {
              reportTitleContainer.style.display = 'none';
            }, 400); // Match the transition duration in CSS (0.4s)
          }
        });
        
        // Radio group for markdown extraction
        document.querySelectorAll('#markdown-radio-group .ghost-radio-button').forEach(button => {
          button.addEventListener('click', function() {
            // Remove active class from all buttons
            document.querySelectorAll('#markdown-radio-group .ghost-radio-button').forEach(b => {
              b.classList.remove('ghost-radio-active');
              // Make icons slightly transparent for inactive buttons
              b.querySelector('i').style.opacity = '0.6';
            });
            
            // Add active class to clicked button
            this.classList.add('ghost-radio-active');
            // Make icon fully opaque for active button
            this.querySelector('i').style.opacity = '1';
            
            // Set value in hidden select
            document.getElementById('markdown-extraction').value = this.getAttribute('data-value');
          });
        });
        
        // Handle hover effects for the radio buttons
        document.querySelectorAll('#markdown-radio-group .ghost-radio-button').forEach(button => {
          button.addEventListener('mouseenter', function() {
            if (!this.classList.contains('ghost-radio-active')) {
              this.querySelector('i').style.opacity = '0.8';
            }
          });
          
          button.addEventListener('mouseleave', function() {
            if (!this.classList.contains('ghost-radio-active')) {
              this.querySelector('i').style.opacity = '0.6';
            }
          });
        });
        
        // "Feeling Lucky" button
        document.getElementById('instant-crawl').addEventListener('click', function() {
          const urlInput = document.getElementById('url');
          if (!urlInput.value) {
            urlInput.value = 'https://news.ycombinator.com/';
          }
          document.getElementById('crawl-btn').click();
        });
        
        // Voice input effect (simulated)
        document.querySelector('.ghost-mic-button').addEventListener('click', function() {
          const urlInput = document.getElementById('url');
          urlInput.placeholder = 'Listening...';
          
          // Simulate voice recognition after 2 seconds
          setTimeout(() => {
            urlInput.value = 'https://news.ycombinator.com/';
            urlInput.placeholder = 'Enter a URL or describe what you want to crawl...';
          }, 2000);
        });
      });
    </script>
  </body>
</html>
