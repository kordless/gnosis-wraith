<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gnosis Writh</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Favicon links -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}" />
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}" />
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
      type="image/x-icon"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
      type="image/x-icon"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ url_for('static', filename='images/favicon.svg') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='images/favicon-128x128.png') }}"
    />
  </head>

  <body>
    <nav class="navbar">
      <div class="logo">
        <span>Gnosis Wraith ðŸ‘»</span>
      </div>
      <ul class="nav-menu">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">
            <i class="fas fa-bars"></i>
          </a>
          <ul class="dropdown-menu">
            <li><a href="{{ url_for('list_reports') }}">Reports</a></li>
            <li><a href="{{ url_for('settings') }}">Settings</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <div class="container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="single-crawl">
          Single URL Crawl
        </button>
        <button class="tab-btn" data-tab="multi-crawl">Multi-URL Crawl</button>
        <button class="tab-btn" data-tab="image-upload">Upload Image</button>
        <button class="tab-btn" data-tab="extension">Browser Extension</button>
        <button class="tab-btn" data-tab="code-examples">Code Examples</button>
      </div>

      <main>
        <!-- Single URL Crawl Tab with JavaScript Option -->
        <section id="single-crawl" class="tab-content card active">
          <h2>Crawl Single URL</h2>
          <div class="crawl-form">
            <div class="form-group">
              <label for="url">URL:</label>
              <input type="url" id="url" placeholder="https://example.com" />
            </div>

            <div class="form-group">
              <label for="report-title">Report Title:</label>
              <input
                type="text"
                id="report-title"
                placeholder="My Web Crawl Report"
              />
            </div>

            <div class="form-group">
              <label for="output-format">Output Format:</label>
              <select id="output-format">
                <option value="markdown">Markdown</option>
                <option value="image">Images Only</option>
                <option value="both">Both</option>
              </select>
            </div>

            <div class="form-group">
              <label for="javascript-enabled-single">JavaScript:</label>
              <select id="javascript-enabled-single">
                <option value="false" selected>Disabled (safer)</option>
                <option value="true">Enabled (better rendering)</option>
              </select>
              <p class="help-text">
                Enable JavaScript when crawling this website
              </p>
            </div>

            <div class="form-group">
              <button id="crawl-btn" class="btn primary">Start Crawling</button>
            </div>
          </div>

          <div id="crawl-status" class="status-box" style="display: none">
            <p>Status: <span id="status-text">Idle</span></p>
            <div class="progress-bar">
              <div id="progress-indicator"></div>
            </div>
          </div>
        </section>

        <!-- Multi URL Crawl Tab with JavaScript Option -->
        <section id="multi-crawl" class="tab-content card">
          <h2>Crawl Multiple URLs</h2>
          <div class="crawl-form">
            <div class="form-group">
              <label for="urls">URLs (one per line):</label>
              <textarea
                id="urls"
                placeholder="https://example.com
            https://another-example.com"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="multi-report-title">Report Title:</label>
              <input
                type="text"
                id="multi-report-title"
                placeholder="My Multi-URL Crawl Report"
              />
            </div>

            <div class="form-group">
              <label for="multi-output-format">Output Format:</label>
              <select id="multi-output-format">
                <option value="markdown">Markdown</option>
                <option value="image">Images Only</option>
                <option value="both">Both</option>
              </select>
            </div>

            <div class="form-group">
              <label for="javascript-enabled-multi">JavaScript:</label>
              <select id="javascript-enabled-multi">
                <option value="false" selected>Disabled (safer)</option>
                <option value="true">Enabled (better rendering)</option>
              </select>
              <p class="help-text">
                Enable JavaScript when crawling these websites
              </p>
            </div>

            <div class="form-group">
              <button id="multi-crawl-btn" class="btn primary">
                Start Crawling
              </button>
            </div>
          </div>

          <div id="multi-crawl-status" class="status-box" style="display: none">
            <p>Status: <span id="multi-status-text">Idle</span></p>
            <div class="progress-bar">
              <div id="multi-progress-indicator"></div>
            </div>
          </div>
        </section>

        <!-- Image Upload Tab -->
        <section id="image-upload" class="tab-content card">
          <h2>Upload Image</h2>
          <div class="upload-form">
            <div class="form-group">
              <label for="image-file-input">Select Image:</label>
              <input type="file" id="image-file-input" accept="image/*" />
            </div>

            <div class="form-group">
              <button id="upload-btn" class="btn primary">
                Upload & Extract Text
              </button>
            </div>
          </div>
          
          <div id="upload-status" class="status-box" style="display: none">
            <p>Status: <span id="upload-status-text">Idle</span></p>
            <div class="progress-bar">
              <div id="upload-progress-indicator"></div>
            </div>
          </div>

          <div id="upload-result" class="result-box" style="display: none">
            <h3>Uploaded Image</h3>
            <div class="image-preview">
              <img id="preview-image" src="" alt="Uploaded image" />
            </div>

            <h3>Extracted Text</h3>
            <div class="extracted-text">
              <pre id="extracted-text-content"></pre>
            </div>
          </div>
        </section>

        <!-- Code Examples Tab -->
        <section id="code-examples" class="tab-content card">
          <h2>Code Examples</h2>
          
          <div class="code-section">
            <h3>Python Code for Image Upload</h3>
            <div class="code-container">
              <button class="copy-btn" title="Copy to clipboard">
                <i class="fas fa-copy"></i>
              </button>
              <pre class="language-python"><code>import requests
import os

def upload_image_to_gnosis_wraith(image_path):
    """
    Upload an image to the Gnosis Wraith API and extract text.
    
    Args:
        image_path (str): Path to the image file
        
    Returns:
        dict: API response with extracted text
    """
    url = "http://localhost:5678/api/upload"
    
    if not os.path.exists(image_path):
        raise FileNotFoundError(f"Image file not found: {image_path}")
    
    files = {
        'image': (os.path.basename(image_path), open(image_path, 'rb'), 'image/png')
    }
    
    try:
        response = requests.post(url, files=files)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"Error uploading image: {e}")
        return None
    finally:
        files['image'][1].close()

# Example usage
if __name__ == "__main__":
    result = upload_image_to_gnosis_wraith("path/to/your/image.png")
    if result and result.get("success"):
        print(f"Extracted text: {result['extracted_text']}")
    else:
        print("Failed to extract text from image")</code></pre>
            </div>
          </div>
          
          <div class="code-section">
            <h3>Python Code for Web Crawling</h3>
            <div class="code-container">
              <button class="copy-btn" title="Copy to clipboard">
                <i class="fas fa-copy"></i>
              </button>
              <pre class="language-python"><code>import requests
import json

def crawl_url_with_gnosis_wraith(url, javascript_enabled=False, llm_provider=None, llm_token=None):
    """
    Crawl a URL with Gnosis Wraith and get the extracted text and optionally LLM summary.
    
    Args:
        url (str): The URL to crawl
        javascript_enabled (bool): Whether to enable JavaScript for the crawl
        llm_provider (str, optional): LLM provider to use for summarization (e.g., 'anthropic', 'openai')
        llm_token (str, optional): API token for the LLM provider
        
    Returns:
        dict: API response with crawl results
    """
    api_url = "http://localhost:5678/api/crawl"
    
    payload = {
        "url": url,
        "javascript_enabled": javascript_enabled,
        "output_format": "markdown"
    }
    
    # Add LLM configuration if provided
    if llm_provider and llm_token:
        payload["llm_provider"] = llm_provider
        payload["llm_token"] = llm_token
    
    try:
        response = requests.post(
            api_url,
            headers={"Content-Type": "application/json"},
            data=json.dumps(payload)
        )
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"Error during crawl: {e}")
        return None

# Example usage
if __name__ == "__main__":
    result = crawl_url_with_gnosis_wraith(
        url="https://example.com",
        javascript_enabled=True
    )
    
    if result and result.get("success"):
        print(f"Processed {len(result['results'])} URLs")
        
        # Print first result details
        if result['results']:
            first_result = result['results'][0]
            print(f"Title: {first_result.get('title')}")
            print(f"Extract: {first_result.get('extracted_text', '')[:100]}...")
    else:
        print("Crawl failed")</code></pre>
            </div>
          </div>
        </section>

        <!-- Browser Extension Tab -->
        <section id="extension" class="tab-content card">
          <h2>Browser Extension</h2>
          <p class="extension-description">
            Download the WebWraith browser extension to analyze links before
            clicking, capture screenshots, and extract text from webpages
            directly in your browser.
          </p>

          <div class="install-instructions">
            <h3>Installation Instructions</h3>
            <ol>
              <li>Download and extract the zip file</li>
              <li>Open your browser's extension management page</li>
              <li>Enable "Developer mode"</li>
              <li>Click "Load unpacked" and select the extracted folder</li>
            </ol>
            <p>Compatible with Chrome, Firefox, and Edge browsers.</p>

            <a
              href="{{ url_for('static', filename='downloads/webwraith-extension.zip') }}"
              class="btn primary download-btn"
            >
              <i class="fas fa-download"></i> Download Extension
            </a>
          </div>
        </section>

        <!-- Crawl Results Section (Shared between tabs) -->
        <section id="crawl-results" class="card" style="display: none">
          <h2>Crawl Results</h2>
          <div id="results-summary"></div>
          <div id="results-content"></div>
          <div id="results-actions">
            <a
              id="report-link"
              href="#"
              class="btn secondary"
              style="display: none"
              >View Report</a
            >
            <a
              id="html-link"
              href="#"
              class="btn secondary"
              style="display: none"
              >View HTML</a
            >
          </div>
        </section>
      </main>

      <footer>
        <p>&copy; 2025 DeepBlue Dynamics. All rights reserved.</p>
        <div class="nav-links">
          <button
            onclick="window.open('https://github.com/kordless/webwraith', '_blank')"
            class="github-button"
            title="GitHub Repository"
          >
            <i class="fab fa-github"></i>
            <span class="star-count"
              ><i class="fas fa-star"></i>
              <span id="github-stars">178</span></span
            >
          </button>
        </div>
      </footer>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  </body>
</html>
