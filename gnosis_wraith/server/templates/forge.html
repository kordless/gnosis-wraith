<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gnosis Wraith | Forge</title>
    
    <!-- React and ReactDOM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.2/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
      tailwind.config = {
        mode: 'jit',
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'terminal-green': '#4ade80',
            }
          }
        }
      }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Prism.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"></script>
    
    <style>
        /* Custom CSS matching gnosis.html */
        .break-words {
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        html, body {
            min-height: 100vh;
            background-color: #111827;
            margin: 0;
            padding: 0;
        }
        
        body {
            overflow-y: auto; 
            min-height: 100vh;
            max-height: 100vh;
        }
        
        .code-container {
            overflow-y: auto !important;
        }
        
        
        pre.code-block {
            background-color: #1e1e1e !important;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
    </style>
</head>
<body class="bg-gray-900 p-0 m-0">
    <div id="root"></div>
    
    <script type="text/babel">
        {% raw %}
        const { useState, useEffect, useRef } = React;
        
        const GnosisForgeInterface = () => {
            const [authStatus, setAuthStatus] = useState('unauthorized');
            const [inputValue, setInputValue] = useState('');
            const [systemStatus, setSystemStatus] = useState('initializing');
            const [activeTab, setActiveTab] = useState('forge');
            const [selectedLanguage, setSelectedLanguage] = useState('python');
            const [customLanguage, setCustomLanguage] = useState('');
            const [generatedCode, setGeneratedCode] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [crawlStats, setCrawlStats] = useState({
                total: 0,
                success: 0,
                errors: 0,
                lastUrl: ''
            });
            const [commentsLevel, setCommentsLevel] = useState(2);
            const [includeErrorHandling, setIncludeErrorHandling] = useState(true);
            
            const codeOutputRef = useRef(null);
            const rootContainerRef = useRef(null);
            const codeContainerRef = useRef(null);
            const [codeContainerVisible, setCodeContainerVisible] = useState(false);
            
            // Language configurations
            const languages = {
                python: { 
                    name: 'Python', 
                    icon: 'fab fa-python', 
                    color: 'text-blue-400',
                    defaultCode: `# Python example for Gnosis Wraith API integration
import requests
import json

def crawl_website(url):
    """Crawl a website using Gnosis Wraith API"""
    response = requests.post('http://localhost:5678/api/crawl', 
                           json={'url': url})
    return response.json()

# Example usage
result = crawl_website('https://example.com')
print(json.dumps(result, indent=2))`
                },
                javascript: { 
                    name: 'JavaScript', 
                    icon: 'fab fa-js-square', 
                    color: 'text-yellow-400',
                    defaultCode: `// JavaScript example for Gnosis Wraith API
async function crawlWebsite(url) {
    const response = await fetch('http://localhost:5678/api/crawl', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
    });
    return await response.json();
}

// Example usage
crawlWebsite('https://example.com')
    .then(result => console.log(result))
    .catch(error => console.error(error));`
                },
                bash: { 
                    name: 'Bash', 
                    icon: 'fas fa-terminal', 
                    color: 'text-green-400',
                    defaultCode: `#!/bin/bash
# Bash script for Gnosis Wraith API

URL="https://example.com"
SERVER_URL="http://localhost:5678"

# Crawl website using curl
curl -X POST "$SERVER_URL/api/crawl" \\
     -H "Content-Type: application/json" \\
     -d "{\\"url\\": \\"$URL\\"}" \\
     | jq '.'`
                },
                powershell: { 
                    name: 'PowerShell', 
                    icon: 'fas fa-terminal', 
                    color: 'text-blue-300',
                    defaultCode: `# PowerShell script for Gnosis Wraith API
$url = "https://example.com"
$serverUrl = "http://localhost:5678"

$body = @{
    url = $url
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "$serverUrl/api/crawl" -Method Post -Body $body -ContentType "application/json"
$response | ConvertTo-Json -Depth 10`
                }
            };
            
            // Initialize
            useEffect(() => {
                const storedAuthCode = localStorage.getItem('gnosis_auth_code');
                if (storedAuthCode && /^c0d3z\d{4}$/i.test(storedAuthCode)) {
                    setAuthStatus('authorized');
                }
                
                setGeneratedCode(languages[selectedLanguage].defaultCode);
                setCodeContainerVisible(true);
                checkServerHealth();
                
                const storedStats = localStorage.getItem('gnosis_crawl_stats');
                if (storedStats) {
                    try {
                        const stats = JSON.parse(storedStats);
                        if (!stats.hasOwnProperty('lastUrl')) {
                            stats.lastUrl = '';
                        }
                        setCrawlStats(stats);
                    } catch (e) {
                        console.error('Error parsing stored crawl stats:', e);
                    }
                }
                
                setTimeout(() => setSystemStatus('online'), 1000);
            }, []);
            
            // Update code when language changes
            useEffect(() => {
                if (languages[selectedLanguage] && (!generatedCode.includes('Generated') || generatedCode === languages[Object.keys(languages).find(key => key !== selectedLanguage)]?.defaultCode)) {
                    setGeneratedCode(languages[selectedLanguage].defaultCode);
                }
                
                setTimeout(() => {
                    if (window.Prism && codeOutputRef.current) {
                        Prism.highlightAllUnder(codeOutputRef.current);
                    }
                }, 100);
            }, [selectedLanguage]);
            
            useEffect(() => {
                setTimeout(() => {
                    if (window.Prism && codeOutputRef.current) {
                        Prism.highlightAllUnder(codeOutputRef.current);
                    }
                }, 100);
            }, [generatedCode]);
            
            const checkServerHealth = async () => {
                try {
                    const response = await fetch('/health', { method: 'HEAD', cache: 'no-cache' });
                    setSystemStatus(response.ok ? 'online' : 'degraded');
                } catch (error) {
                    setSystemStatus('offline');
                }
            };
            
            const handleGenerateCode = async () => {
                if (!inputValue.trim()) return;
                
                setIsGenerating(true);
                
                try {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    const mockCode = generateMockCode(inputValue, selectedLanguage);
                    setGeneratedCode(mockCode);
                } catch (error) {
                    console.error('Code generation failed:', error);
                    setGeneratedCode(`# Error generating code: ${error.message}`);
                } finally {
                    setIsGenerating(false);
                    setInputValue('');
                }
            };
            
            const generateMockCode = (query, language) => {
                // Handle custom language
                const actualLanguage = language === 'custom' ? customLanguage.toLowerCase() : language;
                
                const templates = {
                    python: `# Generated Python code for: ${query}
import requests
import json
from typing import Dict, Any

class GnosisWraithClient:
    def __init__(self, server_url: str = "http://localhost:5678"):
        self.server_url = server_url
    
    def crawl(self, url: str, **options) -> Dict[str, Any]:
        """Crawl a website with optional parameters"""
        payload = {"url": url, **options}
        
        try:
            response = requests.post(f"{self.server_url}/api/crawl", json=payload)
            response.raise_for_status()
            return response.json()
        except requests.RequestException as e:
            raise Exception(f"Crawl failed: {e}")

# Usage example based on query: ${query}
client = GnosisWraithClient()
result = client.crawl("https://example.com")
print(json.dumps(result, indent=2))`,
                    
                    javascript: `// Generated JavaScript code for: ${query}
class GnosisWraithClient {
    constructor(serverUrl = 'http://localhost:5678') {
        this.serverUrl = serverUrl;
    }
    
    async crawl(url, options = {}) {
        const payload = { url, ...options };
        
        try {
            const response = await fetch(\`\${this.serverUrl}/api/crawl\`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                throw new Error(\`HTTP \${response.status}: \${response.statusText}\`);
            }
            
            return await response.json();
        } catch (error) {
            throw new Error(\`Crawl failed: \${error.message}\`);
        }
    }
}

// Usage example based on query: ${query}
const client = new GnosisWraithClient();
client.crawl('https://example.com')
    .then(result => console.log(result))
    .catch(error => console.error(error));`,
                    
                    bash: `#!/bin/bash
# Generated Bash script for: ${query}

SERVER_URL="http://localhost:5678"

crawl_website() {
    local url="$1"
    
    if [[ -z "$url" ]]; then
        echo "Error: URL is required" >&2
        return 1
    fi
    
    local response
    response=$(curl -s -X POST "$SERVER_URL/api/crawl" \\
        -H "Content-Type: application/json" \\
        -d "{\\"url\\": \\"$url\\"}")
    
    if [[ $? -ne 0 ]]; then
        echo "Error: Failed to crawl $url" >&2
        return 1
    fi
    
    echo "$response" | jq '.'
}

# Usage example based on query: ${query}
crawl_website "https://example.com"`,
                    
                    powershell: `# Generated PowerShell script for: ${query}

class GnosisWraithClient {
    [string]$ServerUrl
    
    GnosisWraithClient([string]$serverUrl = "http://localhost:5678") {
        $this.ServerUrl = $serverUrl
    }
    
    [object] Crawl([string]$url, [hashtable]$options = @{}) {
        $payload = @{ url = $url } + $options
        $body = $payload | ConvertTo-Json -Depth 10
        
        try {
            $response = Invoke-RestMethod -Uri "$($this.ServerUrl)/api/crawl" -Method Post -Body $body -ContentType "application/json"
            return $response
        }
        catch {
            throw "Crawl failed: $($_.Exception.Message)"
        }
    }
}

# Usage example based on query: ${query}
$client = [GnosisWraithClient]::new()
$result = $client.Crawl("https://example.com")
$result | ConvertTo-Json -Depth 10`
                };
                
                // For custom languages, create a generic template
                if (language === 'custom' && customLanguage) {
                    return `# Generated ${customLanguage} code for: ${query}\n# Custom language: ${customLanguage}\n# Add your ${customLanguage} implementation here\n\n# Example structure for Gnosis Wraith API integration:\n# 1. Set up HTTP client\n# 2. Create request payload with URL\n# 3. Send POST request to http://localhost:5678/api/crawl\n# 4. Handle response and extract data\n\n# Please adapt this template for ${customLanguage} syntax and conventions`;
                }
                
                return templates[language] || templates.python;
            };
            
            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (err) {
                    return false;
                }
            };
            
            const downloadCode = (code, language) => {
                const extensions = {
                    python: '.py',
                    javascript: '.js',
                    bash: '.sh',
                    powershell: '.ps1'
                };
                
                let extension = extensions[language] || '.txt';
                let filename = 'gnosis_wraith_example';
                
                // Handle custom language
                if (language === 'custom' && customLanguage) {
                    filename = `gnosis_wraith_${customLanguage.toLowerCase()}`;
                    // Try to guess extension based on language name
                    const lang = customLanguage.toLowerCase();
                    if (lang.includes('java')) extension = '.java';
                    else if (lang.includes('php')) extension = '.php';
                    else if (lang.includes('ruby')) extension = '.rb';
                    else if (lang.includes('go')) extension = '.go';
                    else if (lang.includes('rust')) extension = '.rs';
                    else if (lang.includes('c++') || lang.includes('cpp')) extension = '.cpp';
                    else if (lang.includes('c#') || lang.includes('csharp')) extension = '.cs';
                    else extension = '.txt';
                }
                
                const blob = new Blob([code], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${filename}${extension}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleGenerateCode();
                }
            };
            
            return (
                <div ref={rootContainerRef} className="min-h-screen bg-gray-900 text-green-400 p-4 font-mono">
                    <div className="w-full mx-auto flex flex-col">
                        <header className="mb-4">
                            <div className="flex justify-between items-center">
                                <h1 className="text-2xl md:text-3xl font-bold">GNOSIS WRAITH</h1>
                                <div className="flex items-center space-x-2">
                                    <a href="https://github.com/kordless/gnosis-wraith/gnosis_wraith/server/templates/gnosis.html" target="_blank" className="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-xs">
                                        VERSION 3.2.7
                                    </a>
                                </div>
                            </div>
                            <div className="flex items-center space-x-2 mt-2">
                                <div className={`h-3 w-3 rounded-full ${
                                    systemStatus === 'online' ? 'bg-green-500' : 
                                    systemStatus === 'degraded' ? 'bg-yellow-500' :
                                    systemStatus === 'offline' ? 'bg-red-500' : 
                                    'bg-gray-500'
                                }`}></div>
                                <span className="text-sm uppercase">System Status: {systemStatus}</span>
                                <div className="ml-auto text-xs text-gray-500">
                                    Press <kbd className="px-1 py-0.5 bg-gray-800 rounded border border-gray-600">Enter</kbd> to generate
                                </div>
                            </div>
                        </header>

                        {/* Code request input box at top */}
                        <div className="bg-gray-800 border border-gray-700 rounded-md p-4 mb-4">
                            <div className="flex mb-2 border-b border-gray-700 justify-between items-center">
                                <div className="flex">
                                    <a 
                                        href="/wraith"
                                        className="px-4 py-2 text-gray-400 hover:text-green-400">
                                        <i className="fas fa-spider mr-2"></i>Crawler
                                    </a>
                                    <button 
                                        className="px-4 py-2 border-b-2 border-purple-500 text-purple-400">
                                        <i className="fas fa-hammer mr-2"></i>Forge
                                    </button>
                                    <a 
                                        href="/vault" 
                                        className="px-4 py-2 text-gray-400 hover:text-blue-400">
                                        <i className="fas fa-archive mr-2"></i>Vault
                                    </a>
                                    <a 
                                        href="/about"
                                        className="px-4 py-2 text-gray-400 hover:text-orange-400">
                                        <i className="fas fa-info-circle mr-2"></i>About
                                    </a>
                                </div>
                            </div>
                            
                            <div className="flex flex-col">
                                {/* Language and Options Row */}
                                <div className="flex justify-between items-center mb-2">
                                    <div className="flex items-center space-x-6 text-xs text-gray-400">
                                        <div className="flex items-center space-x-2">
                                            <span>Language:</span>
                                            <div className="flex items-center space-x-2 bg-gray-900 p-1 rounded">
                                                {Object.entries(languages).slice(0, 4).map(([key, lang]) => (
                                                    <label key={key} className={`cursor-pointer px-2 py-1 rounded ${selectedLanguage === key ? 'bg-purple-800 text-white' : ''}`}>
                                                        <input
                                                            type="radio"
                                                            name="language"
                                                            value={key}
                                                            checked={selectedLanguage === key}
                                                            onChange={() => setSelectedLanguage(key)}
                                                            className="sr-only"
                                                        />
                                                        <i className={`${lang.icon}`}></i>
                                                    </label>
                                                ))}
                                            </div>
                                            
                                            {/* Custom Language Input */}
                                            <div className="flex space-x-1">
                                                <input 
                                                    type="text"
                                                    className="w-20 px-2 py-1 bg-gray-900 border border-gray-700 rounded text-xs"
                                                    placeholder="Custom..."
                                                    value={selectedLanguage === 'custom' ? customLanguage : ''}
                                                    onChange={(e) => {
                                                        setCustomLanguage(e.target.value);
                                                        if (e.target.value) {
                                                            setSelectedLanguage('custom');
                                                        }
                                                    }}
                                                />
                                                <button
                                                    className="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs"
                                                    onClick={() => {
                                                        if (customLanguage && customLanguage.trim()) {
                                                            // Save to localStorage
                                                            const savedLanguages = JSON.parse(localStorage.getItem('forge_custom_languages') || '[]');
                                                            if (!savedLanguages.includes(customLanguage.trim())) {
                                                                savedLanguages.push(customLanguage.trim());
                                                                localStorage.setItem('forge_custom_languages', JSON.stringify(savedLanguages));
                                                            }
                                                            setSelectedLanguage('custom');
                                                        }
                                                    }}
                                                >
                                                    Add
                                                </button>
                                            </div>
                                            
                                            {/* Display selected language */}
                                            <div className="text-purple-400 font-mono">
                                                {selectedLanguage === 'custom' ? customLanguage || 'Custom' : languages[selectedLanguage]?.name}
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-center space-x-2">
                                            <span>Comments:</span>
                                            <div className="flex items-center space-x-2 bg-gray-900 p-1 rounded">
                                                <label className={`cursor-pointer px-2 py-1 rounded ${commentsLevel === 1 ? 'bg-yellow-800 text-white' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="comments"
                                                        value="1"
                                                        checked={commentsLevel === 1}
                                                        onChange={() => setCommentsLevel(1)}
                                                        className="sr-only"
                                                    />
                                                    MIN
                                                </label>
                                                <label className={`cursor-pointer px-2 py-1 rounded ${commentsLevel === 2 ? 'bg-yellow-800 text-white' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="comments"
                                                        value="2"
                                                        checked={commentsLevel === 2}
                                                        onChange={() => setCommentsLevel(2)}
                                                        className="sr-only"
                                                    />
                                                    STD
                                                </label>
                                                <label className={`cursor-pointer px-2 py-1 rounded ${commentsLevel === 3 ? 'bg-yellow-800 text-white' : ''}`}>
                                                    <input
                                                        type="radio"
                                                        name="comments"
                                                        value="3"
                                                        checked={commentsLevel === 3}
                                                        onChange={() => setCommentsLevel(3)}
                                                        className="sr-only"
                                                    />
                                                    MAX
                                                </label>
                                            </div>
                                        </div>
                                        
                                        <div className="flex items-center space-x-2">
                                            <span>Error Handling:</span>
                                            <div className="flex items-center space-x-2 bg-gray-900 p-1 rounded">
                                                <label className={`cursor-pointer px-2 py-1 rounded transition-colors ${includeErrorHandling ? 'bg-purple-800 text-white' : 'hover:bg-gray-700'}`}>
                                                    <input
                                                        type="checkbox"
                                                        checked={includeErrorHandling}
                                                        onChange={(e) => setIncludeErrorHandling(e.target.checked)}
                                                        className="sr-only"
                                                    />
                                                    <i className={`fas ${includeErrorHandling ? 'fa-toggle-on' : 'fa-toggle-off'} mr-1`}></i>
                                                    {includeErrorHandling ? 'ON' : 'OFF'}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex space-x-2">
                                    <input
                                        type="text"
                                        placeholder="Describe the code you want to generate..."
                                        className="flex-grow px-3 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:border-purple-500"
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                    />
                                    <button
                                        className="px-4 py-2 bg-purple-800 hover:bg-purple-700 text-white rounded disabled:opacity-50"
                                        onClick={handleGenerateCode}
                                        disabled={isGenerating || !inputValue.trim()}
                                    >
                                        {isGenerating ? (
                                            <>
                                                <i className="fas fa-spinner fa-spin mr-2"></i>
                                                Forging...
                                            </>
                                        ) : (
                                            'Generate'
                                        )}
                                    </button>
                                </div>
                            </div>

                        </div>

                        <div className="flex flex-col md:flex-row gap-4 mb-4" style={{ minHeight: '400px' }}>
                            <div className="flex-grow">
                                <div 
                                    ref={codeContainerRef} 
                                    className="bg-gray-800 border border-gray-700 rounded-md overflow-auto code-container"
                                    style={{ visibility: codeContainerVisible ? 'visible' : 'hidden' }}
                                >
                                    <div className="px-4 py-2 border-b border-gray-700 bg-gray-900 flex justify-between items-center">
                                        <div className="flex items-center space-x-2">
                                            <h2 className="text-lg font-semibold text-green-400">Generated Code</h2>
                                            <div className="flex items-center space-x-1">
                                                <i className={`${languages[selectedLanguage]?.icon || 'fas fa-code'} ${languages[selectedLanguage]?.color || 'text-gray-400'}`}></i>
                                                <span className="text-sm text-gray-400">{languages[selectedLanguage]?.name || customLanguage || 'Custom'}</span>
                                            </div>
                                        </div>
                                        <div className="flex space-x-2">
                                            <button 
                                                className="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded"
                                                onClick={async () => {
                                                    const success = await copyToClipboard(generatedCode);
                                                    // Add visual feedback here
                                                }}
                                            >
                                                <i className="fas fa-copy mr-1"></i>Copy
                                            </button>
                                            <button 
                                                className="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded"
                                                onClick={() => downloadCode(generatedCode, selectedLanguage)}
                                            >
                                                <i className="fas fa-download mr-1"></i>Download
                                            </button>
                                        </div>
                                    </div>
                                    <div className="p-4" ref={codeOutputRef}>
                                        <pre className="code-block">
                                            <code className={`language-${selectedLanguage}`}>
                                                {generatedCode}
                                            </code>
                                        </pre>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="space-y-4 md:w-1/4 flex-shrink-0">
                                <div className="bg-gray-800 border border-gray-700 rounded-md p-4">
                                    <h2 className="text-xl mb-3">System Controls</h2>
                                    <div className="space-y-2">
                                        <div className={`${authStatus === 'authorized' ? 'text-green-500' : 'text-yellow-500'}`}>
                                            Status: {authStatus === 'authorized' ? 'AUTHORIZED' : 'UNAUTHORIZED'}
                                        </div>
                                        
                                        {authStatus === 'authorized' && (
                                            <>
                                                <div className="border-t border-gray-700 my-2 pt-2">
                                                    <div className="text-green-400 font-semibold">LLM Settings</div>
                                                </div>

                                                
                                                {/* Provider selection dropdown */}
                                                <div className="text-xs text-gray-400 mb-1">LLM Provider:</div>
                                                <div className="mb-2">
                                                    <select 
                                                        className="w-full px-2 py-1 bg-gray-900 border border-gray-700 rounded text-xs"

                                                        value={localStorage.getItem('gnosis_wraith_llm_provider') || 'anthropic'}
                                                        onChange={(e) => {
                                                            localStorage.setItem('gnosis_wraith_llm_provider', e.target.value);
                                                            setCrawlStats({...crawlStats});
                                                        }}
                                                    >
                                                        <option value="anthropic">Anthropic (Claude)</option>
                                                        <option value="openai">OpenAI (GPT)</option>
                                                        <option value="gemini">Google (Gemini)</option>
                                                    </select>
                                                </div>
                                                
                                                {/* API Key input - same as gnosis.html */}
                                                {(() => {
                                                    const provider = localStorage.getItem('gnosis_wraith_llm_provider') || 'anthropic';
                                                    
                                                    let keyName, cookieName;
                                                    switch(provider) {
                                                        case 'anthropic':
                                                            keyName = 'Anthropic API Token';
                                                            cookieName = 'gnosis_wraith_llm_token_anthropic';
                                                            break;
                                                        case 'openai':
                                                            keyName = 'OpenAI API Token';
                                                            cookieName = 'gnosis_wraith_llm_token_openai';
                                                            break;
                                                        case 'gemini':
                                                            keyName = 'Google Gemini API Token';
                                                            cookieName = 'gnosis_wraith_llm_token_gemini';
                                                            break;
                                                        default:
                                                            keyName = 'API Token';
                                                            cookieName = 'gnosis_wraith_llm_token_anthropic';
                                                    }
                                                    
                                                    const getCookie = (name) => {
                                                        const nameEQ = `${name}=`;
                                                        const ca = document.cookie.split(';');
                                                        for (let i = 0; i < ca.length; i++) {
                                                            let c = ca[i];
                                                            while (c.charAt(0) === ' ') c = c.substring(1);
                                                            if (c.indexOf(nameEQ) === 0) {
                                                                return c.substring(nameEQ.length, c.length);
                                                            }
                                                        }
                                                        return '';
                                                    };
                                                    
                                                    const setCookie = (name, value, days = 90) => {
                                                        const date = new Date();
                                                        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                                                        const expires = `expires=${date.toUTCString()}`;
                                                        document.cookie = `${name}=${value};${expires};path=/;SameSite=Strict`;
                                                    };
                                                    
                                                    const deleteCookie = (name) => {
                                                        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
                                                    };
                                                    
                                                    const currentKey = getCookie(cookieName);
                                                    
                                                    return (
                                                        <>
                                                            <div className="text-xs text-gray-400 mb-1">{keyName}:</div>
                                                            <div className="flex space-x-1">
                                                                <input 
                                                                    type="password"
                                                                    className="flex-grow px-2 py-1 bg-gray-900 border border-gray-700 rounded text-xs cursor-pointer"
                                                                    placeholder={currentKey ? "••••••••••••••••••••" : "Click 'Set' to configure"}
                                                                    value={currentKey ? "••••••••••••••••••••" : ""}
                                                                    readOnly={true}
                                                                    title="Click 'Set' button to configure API token"
                                                                />
                                                                <button
                                                                    className="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs"

                                                                    onClick={() => {
                                                                        // If we have a key, confirm deletion
                                                                        if (currentKey) {
                                                                            // Create an inline modal for confirmation
                                                                            const confirmBox = document.createElement('div');
                                                                            confirmBox.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
                                                                            confirmBox.innerHTML = `
                                                                                <div class="bg-gray-800 border border-gray-700 rounded-md p-4 max-w-md w-full">
                                                                                    <div class="text-green-400 font-semibold mb-2">Confirm</div>
                                                                                    <div class="text-white mb-4">Are you sure you want to remove this API key?</div>
                                                                                    <div class="flex justify-end space-x-2">
                                                                                        <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm" id="cancel-btn">Cancel</button>
                                                                                        <button class="px-3 py-1 bg-red-700 hover:bg-red-600 text-white rounded text-sm" id="confirm-btn">Remove</button>
                                                                                    </div>
                                                                                </div>
                                                                            `;
                                                                            document.body.appendChild(confirmBox);
                                                                            
                                                                            // Add event handlers
                                                                            document.getElementById('cancel-btn').addEventListener('click', () => {
                                                                                document.body.removeChild(confirmBox);
                                                                            });
                                                                            document.getElementById('confirm-btn').addEventListener('click', () => {
                                                                                deleteCookie(cookieName);
                                                                                setCrawlStats({...crawlStats});
                                                                                document.body.removeChild(confirmBox);
                                                                            });
                                                                        } else {
                                                                            // Create an inline modal for entering a new key
                                                                            const inputBox = document.createElement('div');
                                                                            inputBox.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
                                                                            inputBox.innerHTML = `
                                                                                <div class="bg-gray-800 border border-gray-700 rounded-md p-4 max-w-md w-full">
                                                                                    <div class="text-green-400 font-semibold mb-2">Enter ${keyName}</div>
                                                                                    <input type="text" id="api-key-input" class="w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded mb-4" placeholder="Enter your API token..."/>
                                                                                    <div class="flex justify-end space-x-2">
                                                                                        <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm" id="cancel-key-btn">Cancel</button>
                                                                                        <button class="px-3 py-1 bg-green-700 hover:bg-green-600 text-white rounded text-sm" id="save-key-btn">Save</button>
                                                                                    </div>
                                                                                </div>
                                                                            `;
                                                                            document.body.appendChild(inputBox);
                                                                            
                                                                            // Focus the input field
                                                                            setTimeout(() => {
                                                                                document.getElementById('api-key-input').focus();
                                                                            }, 100);
                                                                            
                                                                            // Add event handlers
                                                                            document.getElementById('cancel-key-btn').addEventListener('click', () => {
                                                                                document.body.removeChild(inputBox);
                                                                            });
                                                                            document.getElementById('save-key-btn').addEventListener('click', () => {
                                                                                const inputEl = document.getElementById('api-key-input');
                                                                                const newKey = inputEl.value.trim();
                                                                                
                                                                                if (newKey) {
                                                                                    setCookie(cookieName, newKey);
                                                                                    setCrawlStats({...crawlStats});
                                                                                    document.body.removeChild(inputBox);
                                                                                } else {
                                                                                    // Highlight input with red border if empty
                                                                                    inputEl.classList.add('border-red-500');
                                                                                    setTimeout(() => {
                                                                                        inputEl.classList.remove('border-red-500');
                                                                                    }, 2000);
                                                                                }
                                                                            });
                                                                            
                                                                            // Handle enter key
                                                                            document.getElementById('api-key-input').addEventListener('keydown', (e) => {
                                                                                if (e.key === 'Enter') {
                                                                                    document.getElementById('save-key-btn').click();
                                                                                } else if (e.key === 'Escape') {
                                                                                    document.getElementById('cancel-key-btn').click();
                                                                                }
                                                                            });
                                                                        }
                                                                    }}
                                                                >
                                                                    {currentKey ? 'Clear' : 'Set'}
                                                                </button>
                                                            </div>
                                                        </>
                                                    );
                                                })()}
                                                
                                                <div className="mt-2 text-xs text-gray-500 italic">
                                                    API tokens are stored locally in cookies with SameSite=Strict
                                                </div>
                                                
                                                <button 
                                                    className="w-full mt-3 bg-gray-900 hover:bg-gray-700 text-xs border border-gray-700 rounded p-1"
                                                    onClick={() => {
                                                        // Create a nice modal for logout confirmation
                                                        const logoutModal = document.createElement('div');
                                                        logoutModal.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
                                                        logoutModal.innerHTML = `
                                                            <div class="bg-gray-800 border border-gray-700 rounded-lg p-6 max-w-md w-full mx-4">
                                                                <div class="flex items-center mb-4">
                                                                    <i class="fas fa-sign-out-alt text-yellow-500 text-xl mr-3"></i>
                                                                    <h3 class="text-lg font-semibold text-yellow-400">Confirm Logout</h3>
                                                                </div>
                                                                <p class="text-gray-300 mb-6">
                                                                    Are you sure you want to log out? This will clear your authentication and you'll need to enter your access code again.
                                                                </p>
                                                                <div class="flex justify-end space-x-3">
                                                                    <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm transition-colors" id="cancel-logout-btn">
                                                                        Cancel
                                                                    </button>
                                                                    <button class="px-4 py-2 bg-red-700 hover:bg-red-600 text-white rounded text-sm transition-colors" id="confirm-logout-btn">
                                                                        <i class="fas fa-sign-out-alt mr-1"></i>Log Out
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        `;
                                                        document.body.appendChild(logoutModal);
                                                        
                                                        // Add event handlers
                                                        document.getElementById('cancel-logout-btn').addEventListener('click', () => {
                                                            document.body.removeChild(logoutModal);
                                                        });
                                                        
                                                        document.getElementById('confirm-logout-btn').addEventListener('click', () => {
                                                            localStorage.removeItem('gnosis_auth_code');
                                                            setAuthStatus('unauthorized');
                                                            document.body.removeChild(logoutModal);
                                                        });
                                                        
                                                        // Close modal when clicking outside
                                                        logoutModal.addEventListener('click', (e) => {
                                                            if (e.target === logoutModal) {
                                                                document.body.removeChild(logoutModal);
                                                            }
                                                        });
                                                        
                                                        // Handle escape key
                                                        const handleEscape = (e) => {
                                                            if (e.key === 'Escape') {
                                                                document.body.removeChild(logoutModal);
                                                                document.removeEventListener('keydown', handleEscape);
                                                            }
                                                        };
                                                        document.addEventListener('keydown', handleEscape);
                                                    }}
                                                >
                                                    Log Out
                                                </button>
                                            </>
                                        )}

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Render the app
        ReactDOM.render(<GnosisForgeInterface />, document.getElementById('root'));
        {% endraw %}
    </script>
</body>
</html>
